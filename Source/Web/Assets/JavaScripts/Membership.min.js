var Membership={_isLoggedIn:false,_logOutUrl:"",_minUserNameLength:4,_minPasswordLength:4,_redirectToPrevious:false,_centerMeTimer:null,get_isLoggedIn:function(){return Membership._isLoggedIn},set_isLoggedIn:function(A){Membership._isLoggedIn=A},set_logOutUrl:function(A){Membership._logOutUrl=A},set_minPasswordLength:function(A){Membership._minPasswordLength=A},init:function(){$.validator.addMethod("userName",function(E,D){return/^([a-zA-Z])[a-zA-Z_-]*[\w_-]*[\S]$|^([a-zA-Z])[0-9_-]*[\S]$|^[a-zA-Z]*[\S]$/.test(E)},"User name must be alphanumeric characters which starts with alphabet and can only contains special characters dash and underscore.");$("#topUserTabs > ul").tabs(defaults={navClass:"sidebar-tabs-nav",selectedClass:"sidebar-tabs-selected",unselectClass:"sidebar-tabs-nav-item",panelClass:"sidebar-tabs-panel",hideClass:"sidebar-tabs-hide"});$("#topUserTabs").show();$("#lnkLogin").click(function(){Membership.showLogin(false)});$("#lnkSignup").click(function(){Membership.showSignUp()});$("#lnkChangePassword").click(function(){Membership.showChangePassword()});$("#lnkLogout").click(function(){Membership.logout()});$("#membershipBox").keydown(function(D){if(D.keyCode===27){Membership._hide(false)}});$("#membershipClose").click(function(){Membership._hide(false)});$("#frmOpenIdLogin").validate({rules:{identifier:"required"},messages:{identifier:"Open ID cannot be blank."},errorPlacement:B,highlight:C,unhighlight:A});$("#frmLogin").validate({rules:{userName:"required",password:"required"},messages:{userName:"User name cannot be blank.",password:"Password cannot be blank."},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#loginMessage").hide().text("").css("color","");$U.disableInputs("#loginSection",true);$U.showProgress("Authenticating...","#chkLoginRememberMe")},success:function(F){$U.disableInputs("#loginSection",false);$U.hideProgress();if(F.isSuccessful){Membership._hide(true);window.location.reload()}else{$("#loginMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"});$U.focus("txtLoginUserName")}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmForgotPassword").validate({rules:{email:{required:true,email:true}},messages:{email:{required:"Email cannot be blank.",email:"Invalid email address format."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$U.disableInputs("#loginSection",true);$U.showProgress("Verifying...","#txtForgotEmail")},success:function(F){$U.disableInputs("#loginSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Password Sent","You new password is successfully sent to \r\n your email address.",false,function(){Membership._hide(true)})}else{$("#forgotPasswordMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"});$U.focus("txtForgotEmail")}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmChangePassword").validate({rules:{oldPassword:"required",newPassword:{required:true,minlength:Membership._minPasswordLength},confirmPassword:{required:true,equalTo:"#txtChangeNewPassword"}},messages:{oldPassword:"Old password cannot be blank",newPassword:{required:"New password cannot be blank",minlength:"New password cannot be less than "+Membership._minPasswordLength+"character."},confirmPassword:{required:"Confirm password cannot be blank",equalTo:"Confirm password must match new password."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#changePasswordMessage").hide().text("Changing...").css("color","");$U.disableInputs("#changePasswordSection",true);$U.showProgress("Changing...","#txtChangenConfirmPassword")},success:function(F){$U.disableInputs("#changePasswordSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Password Changed","Your password is successfully changed.",false,function(){Membership._hide(true)})}else{$("#changePasswordMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"})}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#frmSignup").validate({rules:{userName:{required:true,minlength:Membership._minUserNameLength,userName:true},password:{required:true,minlength:Membership._minPasswordLength},email:{required:true,email:true}},messages:{userName:{required:"User name cannot be blank.",minlength:"User name cannot be less than "+Membership._minUserNameLength+"character."},password:{required:"Password cannot be blank.",minlength:"Password cannot be less than "+Membership._minPasswordLength+"character."},email:{required:"Email cannot be blank.",email:"Invalid email address format."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$("#signupMessage").hide().text("Signing up...").css("color","");$U.disableInputs("#signupSection",true);$U.showProgress("Signing up...","#txtSignupEmail")},success:function(F){$U.disableInputs("#signupSection",false);$U.hideProgress();if(F.isSuccessful){$U.messageBox("Account Created","Your account is succcessfully created. Please click the link in registration email to activate your account.",false,function(){Membership._hide(true);window.location.reload()})}else{$("#signupMessage").text(F.errorMessage).css({color:"#ff0000",display:"block"})}}};$(E).ajaxSubmit(D);return false},errorPlacement:B,highlight:C,unhighlight:A});$("#lnkChangeEmail").click(function(){$("#emailViewSection").hide();$("#emailEditSection").show();$U.focus("txtChangeEmail")});$("#lnkCancelEmail").click(function(){$("#emailEditSection").hide();$("#emailViewSection").show()});$("#frmChangeEmail").validate({rules:{email:{required:true,email:true}},messages:{email:{required:"Email cannot be blank.",email:"Invalid email address format."}},submitHandler:function(E){var D={dataType:"json",beforeSubmit:function(){$U.disableInputs("#emailEditSection",true);$U.showProgress("Updating email...","#btnChangeEmail")},success:function(F){$U.disableInputs("#emailEditSection",false);$U.hideProgress();if(F.isSuccessful){$("#emailEditSection").hide();$("#emailViewSection").show();$("#spnEmail").text($("#txtChangeEmail").val())}else{$U.focus("txtChangeEmail");$("#spnChangeEmailError").text(F.errorMessage).show()}}};$(E).ajaxSubmit(D);return false},errorPlacement:function(D,E){$("#spnChangeEmailError").text(D.text())},highlight:function(E,D){$("#spnChangeEmailError").show()},unhighlight:function(E,D){$("#spnChangeEmailError").hide()}});function B(D,E){E.next("span.error").text(D.text())}function C(E,D){$(E).next("span.error").show()}function A(E,D){$(E).next("span.error").hide()}},dispose:function(){Membership._clearCenterMeTimer();$("#membershipBox").unbind();$("#membershipClose").unbind();$("#lnkLogin").unbind();$("#lnkSignup").unbind();$("#lnkChangePassword").unbind();$("#lnkLogout").unbind()},showLogin:function(A){Membership._redirectToPrevious=A;$("#signupSection").hide();$("#changePasswordSection").hide();$("#loginSection").show();Membership._show();$U.focus("txtOpenId")},showChangePassword:function(){$("#signupSection").hide();$("#loginSection").hide();$("#changePasswordSection").show();Membership._show();$U.focus("txtChangeOldPassword")},showSignUp:function(){Membership._redirectToPrevious=false;$("#loginSection").hide();$("#changePasswordSection").hide();$("#signupSection").show();Membership._show();$U.focus("txtSignupUserName")},logout:function(){$.ajax({url:Membership._logOutUrl,type:"POST",dataType:"json",data:"__MVCASYNCPOST=true",success:function(A){if(A.isSuccessful){window.location.reload()}else{$U.alert("Error",A.errorMessage,true)}}})},_show:function(){$U.blockUI();var A=$("#membershipBox");$U.center(A);A.fadeIn();Membership._centerMe();A.find("input").each(function(){var B=$(this)[0];var C=B.type.toLowerCase();if((C=="text")||(C=="file")||(C=="password")){B.value=""}else{if((C=="checkbox")||(C=="radio")){B.checked=false}}});$("span.error").hide();$("span.message").hide()},_hide:function(A){$U.disableInputs("#membershipBox",false);$U.hideProgress();Membership._clearCenterMeTimer();$("#membershipBox").fadeOut("normal",function(){$U.unblockUI();if((!A)&&(Membership._redirectToPrevious)){window.location=(document.referrer.length>0)?document.referrer:"/"}})},_centerMe:function(){var A=$("#membershipBox");$U.center(A);Membership._clearCenterMeTimer();Membership._centerMeTimer=setInterval(function(){Membership._centerMe()},2000)},_clearCenterMeTimer:function(){if(Membership._centerMeTimer!=null){clearInterval(Membership._centerMeTimer);Membership._centerMeTimer=null}}};